<%
  show_deal ||= "Yes"
  show_investors ||= "Yes"
%>
<div class="associated_entity" data-controller="tabs tabdetails">
    <nav class="nav nav-tabs nav-fill nav-justified"  role="tablist">
      <a class="nav-link active" data-bs-toggle="pill" data-toggle="tab" href="#docs-tab">Deal Docs</a>
      
      <% if show_deal == "Yes" %>
        <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#deal-tab">Deal</a>
      <% end %>
      <% if show_investors == "Yes" %>
        <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#investors-tab" data-action="click->tabdetails#loadData">Investments</a>
      <% end %>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#activities-tab">Deal Steps</a>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#access-tab">Access Rights</a>
    </nav>
    
  
  
  <div class="tab-content">
      <div id="deal-tab" class="tab-pane fade">
        <div id="deal_activities" class="associated_entity">
          <%= render "/deals/show", deal: deal %>
        </div>
      </div>
      <div id="docs-tab" class="tab-pane fade in show active">
        <div id="deal_docs" class="associated_entity">
          <%= render "/deal_docs/index", deal: deal, deal_docs: deal.deal_docs.includes(:tags), 
              deal_investor: nil, title: "Deal Docs" %>
        </div>     
      </div>
      <div id="activities-tab" class="tab-pane fade">
        <div id="deal_activities" class="associated_entity">
          <% params[:template] = true %>
          <%= render "deal_activities/index", deal: deal, 
            deal_activities: deal.deal_activities.templates(deal).with_all_rich_text.includes(:deal_investor), 
            template: true, params: {deal_id: deal.id, back_to: deal_path(deal, grid_view: true, tab: "activities-tab"), template: true} %>
        </div>  
      </div>

      <div id="investors-tab" class="tab-pane fade">
        <div id="deal_investors" class="associated_entity">          
          <%= link_to deal_investors_path(deal_id: deal.id), class: "load_data_link", 
              data: { turbo_frame: 'deal_investors_frame' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "deal_investors_frame", target: "_top" do %>
          <% end %>

        </div>  
      </div>

      <div id="access-tab" class="tab-pane fade">
        <div id="access_rights" class="associated_entity">

          <%  access_right = AccessRight.new(
            owner_id: @deal.id, 
            access_type: "Deal", 
            owner_type: "Deal", 
            entity_id: deal.entity_id) %> 

          <%= render "access_rights/index", access_rights: deal.access_rights.includes(:investor), access_right: access_right %>
        </div>  
      </div>

  </div>
  
  </div>