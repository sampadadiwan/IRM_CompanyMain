<div class="associated_entity" data-controller="tabs tabdetails">

  <% label = investor.is_holdings_entity ? "#{investor.category} Investors" : "Investor User" %>

  <nav class="nav nav-tabs nav-fill nav-justified"  role="tablist">
    <a class="nav-link active" data-bs-toggle="pill" data-toggle="tab" href="#access-rights-tab">
          Access Rights
    </a>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#investors-tab">
      <%= label %>
    </a>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#investments-tab" 
          data-action="click->tabdetails#loadData">
        Investments
    </a>

    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#notes-tab" 
          data-action="click->tabdetails#loadData">
        Notes
    </a>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#tasks-tab" 
          data-action="click->tabdetails#loadData">
        Tasks
    </a>
  </nav>

  <div class="tab-content" data-controller="datatable">
      <div id="access-rights-tab" class="tab-pane fade in show active">
        <div id="access_rights" class="associated_entity">
          <% access_right = AccessRight.new(access_to_investor_id: investor.id, 
              owner_id: investor.investee_entity_id, 
              access_type: "Investment", 
              owner_type: "Entity", 
              entity_id: current_user.entity_id) %>
              
          <%= render "/access_rights/index", access_rights: AccessRight.includes(:owner, :investor).for_investor(investor).includes(:owner, :investor), access_right: access_right %>
        </div>
      </div>
      <div id="investors-tab" class="tab-pane fade">
        <div id="investor_accesses" class="associated_entity">
          <%= render "/investor_accesses/index", investor_accesses: investor.investor_accesses.includes(:user), 
              investor: investor, label: label %>
        </div>     
      </div>

      <div id="investments-tab" class="tab-pane fade">
        <div id="investments" class="associated_entity">
          <%= link_to investments_path(investor_id: investor.id), class: "load_data_link", data: { turbo_frame: 'investments_frame' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "investments_frame", target: "_top" do %>
          <% end %>
        </div>     
      </div>

      <div id="notes-tab" class="tab-pane fade">
        <div id="notes" class="associated_entity">
          <%= link_to notes_path(investor_id: investor.id), class: "load_data_link", data: { turbo_frame: 'notes_frame' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "notes_frame", target: "_top" do %>
          <% end %>
        </div>     
      </div>

      <div id="tasks-tab" class="tab-pane fade">
        <div id="tasks" class="associated_entity">
          <%= link_to tasks_path(investor_id: investor.id), class: "load_data_link", data: { turbo_frame: 'task_list' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "task_list", target: "_top" do %>
          <% end %>
        </div>     
      </div>

  </div>

</div>
