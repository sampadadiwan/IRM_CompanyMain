
  <%= render ToggleCard.new(title: "Interest: #{interest.secondary_sale.name}", css_class: "show_interest", state: "show") do %>

  <div class="row">
    <!-- Left Column: Main Info -->
    <div class="col-lg-8">

      <!-- Interest Details -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header border-bottom py-3">
          <h5 class="mb-0 fw-bold"><i class="ti ti-file-analytics me-2 text-primary"></i>Interest Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Entity</label>
              <div class="fs-4 fw-medium"><%= interest.entity.name %></div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Buyer Entity Name</label>
              <div class="fs-4 fw-medium"><%= interest.buyer_entity_name.presence %></div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Investor</label>
              <div class="fs-4 fw-medium"><%= interest.investor&.investor_name %></div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">User</label>
              <div class="fs-4 fw-medium"><%= interest.user&.full_name %></div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Secondary Sale</label>
              <div class="fs-4 fw-medium">
                <%= link_to interest.secondary_sale.name, interest.secondary_sale, class: "text-decoration-none fw-bold text-primary" %>
                <div class="fs-6 text-muted">
                  <%= l interest.secondary_sale.start_date %> - <%= l interest.secondary_sale.end_date %>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Quantity</label>
              <div class="fs-4 fw-medium"><%= custom_format_number interest.quantity, params %></div>
            </div>

            <div class="col-md-6">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Price</label>
              <div class="fs-4 fw-medium"><%= custom_format_number interest.price, params %></div>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Details</label>
              <div class="fs-4 fw-medium"><%= interest.details %></div>
            </div>
          </div>
        </div>
      </div>



      <!-- Other Details -->
      <% if current_user %>
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header border-bottom py-3">
            <h5 class="mb-0 fw-bold"><i class="ti ti-settings me-2 text-warning"></i>Other Details</h5>
          </div>
          <div class="card-body">
             <table class="table table-borderless mb-0">
              <%= display_custom_fields(interest) %>
             </table>
          </div>
        </div>
      <% end %>

    </div>

    <!-- Right Column: Status & Attributes -->
    <div class="col-lg-4">
      <% if interest.allocation_quantity > 0 %>
        <!-- Allocation Details -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header border-bottom py-3">
            <h5 class="mb-0 fw-bold"><i class="ti ti-chart-pie me-2 text-success"></i>Allocation Details</h5>
          </div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-6">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Allocated Quantity</label>
                <div class="fs-4 fw-medium"><%= interest.allocation_quantity %></div>
              </div>

              <div class="col-md-6">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Allocation Amount</label>
                <div class="fs-4 fw-medium"><%= money_to_currency interest.allocation_amount, params %></div>
              </div>
            </div>
          </div>
        </div>
      <% end %>

      <!-- KYC & Banking Details -->
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header border-bottom py-3">
          <h5 class="mb-0 fw-bold"><i class="ti ti-building-bank me-2 text-info"></i>KYC & Banking Details</h5>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Contact Name</label>
              <div class="fs-4 fw-medium"><%= interest.contact_name %></div>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Buyer Emails for ESignatures</label>
              <div class="fs-4 fw-medium"><%= interest.buyer_signatory_emails %></div>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Address</label>
              <div class="fs-4 fw-medium"><%= interest.address %></div>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">City</label>
              <div class="fs-4 fw-medium"><%= interest.city %></div>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">PAN</label>
              <div class="fs-4 fw-medium">
                <%= interest.PAN %>
                <% show_pan_verification = !interest.secondary_sale.disable_pan_kyc && interest.entity.entity_setting.pan_verification %>
                <% if show_pan_verification && current_user %>
                  <div class="mt-2">
                    <%= render "investor_kycs/pan_verification", model: interest %>
                  </div>
                <% end %>
              </div>
              <% if params[:debug].present? %>
                <div class="mt-2 small text-muted">
                  <div>Response: <%= interest.pan_verification_response %></div>
                  <div>Status: <%= interest.pan_verification_status %></div>
                </div>
              <% end %>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Bank Account</label>
              <div class="fs-4 fw-medium">
                <%= interest.bank_account_number %>
                <% if current_user && !interest.secondary_sale.disable_bank_kyc %>
                  <div class="mt-2">
                    <%= render "investor_kycs/bank_verification", model: interest %>
                  </div>
                <% end %>
              </div>
              <% if params[:debug].present? %>
                <div class="mt-2 small text-muted">
                  <div>Response: <%= interest.bank_verification_response %></div>
                  <div>Status: <%= interest.bank_verification_status %></div>
                </div>
              <% end %>
            </div>

            <div class="col-12">
              <label class="text-muted text-uppercase fw-bold fs-1 mb-1">IFSC Code</label>
              <div class="fs-4 fw-medium"><%= interest.ifsc_code %></div>
            </div>

            <% if params[:debug].present? %>
              <div class="col-12">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Demat</label>
                <div class="fs-4 fw-medium"><%= interest.demat %></div>
              </div>

              <div class="col-12">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">I agree to enter into the SPA</label>
                <div class="fs-4 fw-medium">
                   <span class="badge <%= interest.final_agreement ? 'bg-success' : 'bg-warning' %>">
                    <%= interest.final_agreement ? "Yes" : "No" %>
                  </span>
                  <% if interest.final_agreement_user %>
                    <div class="fs-6 text-muted">Accepted By: <%= interest.final_agreement_user.full_name %></div>
                  <% end %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="card shadow-sm border-0 mb-4">
        <div class="card-header border-bottom py-3 px-4">
          <h6 class="mb-0 fw-bold d-flex align-items-center"><i class="ti ti-list me-2 text-warning"></i>Status & Attributes</h6>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between align-items-center py-3 px-4" id="short_listed">
            <span class="text-muted">Status</span>
            <div class="text-end">
              <span class="badge <%= short_listed_css(interest) %>">
                <%= interest.short_listed_status.humanize %>
              </span>
              <div class="small text-muted mt-1">
                <%= interest.status_updated_at ? "At: #{l interest.status_updated_at}" : "" %>
                <br>
                <%= interest.status_updated_by ? "By: #{interest.status_updated_by.full_name}" : "" %>
              </div>
            </div>
          </li>

          <li class="list-group-item d-flex justify-content-between align-items-center py-3 px-4" id="verified">
            <span class="text-muted">Verified</span>
            <span class="fw-bold"><%= display_boolean interest.verified %></span>
          </li>

          <% if params[:debug].present? %>
             <li class="list-group-item d-flex justify-content-between align-items-center py-3 px-4" id="completed">
              <span class="text-muted">Completed</span>
              <span class="fw-bold"><%= display_boolean(interest.completed) %></span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

  </div>
  <% end %>
