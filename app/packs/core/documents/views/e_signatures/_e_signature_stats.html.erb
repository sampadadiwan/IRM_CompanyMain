<%

  template = params[:template] || "/e_signatures/e_signatures"

  if params[:fund_id].present?
    esig_types = {
      completed: { path: documents_path(fund_id: params[:fund_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:capital_commitment_fund_id, :eq, params[:fund_id]],
          [:owner_type, :eq, "CapitalCommitment"],
          [:esign_status, :eq, "completed"]
        ])), subtitle: "Completed", progress_bar_color: "success", icon: "ti ti-check" },
      failed: { path: documents_path(fund_id: params[:fund_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:capital_commitment_fund_id, :eq, params[:fund_id]],
          [:owner_type, :eq, "CapitalCommitment"],
          [:esign_status, :eq, "failed"]
        ])), subtitle: "Failed", progress_bar_color: "danger", icon: "ti ti-x" },
      requested: { path: documents_path(fund_id: params[:fund_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:capital_commitment_fund_id, :eq, params[:fund_id]],
          [:owner_type, :eq, "CapitalCommitment"],
          [:esign_status, :eq, "requested"]
        ])), subtitle: "Requested", progress_bar_color: "info", icon: "ti ti-mail" },
      all: { path: documents_path(fund_id: params[:fund_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:capital_commitment_fund_id, :eq, params[:fund_id]],
          [:owner_type, :eq, "CapitalCommitment"]
        ])), subtitle: "Total", progress_bar_color: "primary", icon: "ti ti-list" }
    }

    documents = Document.sent_for_esign.where(owner_type: "CapitalCommitment").joins(capital_commitment: :fund).where(capital_commitments: { fund_id: params[:fund_id] })

  elsif params[:secondary_sale_id].present?
    esig_types = {
      completed: { path: documents_path(secondary_sale_id: params[:secondary_sale_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:offer_secondary_sale_id, :eq, params[:secondary_sale_id]],
          [:owner_type, :eq, "Offer"],
          [:esign_status, :eq, "completed"]
        ])), subtitle: "Completed", progress_bar_color: "success", icon: "ti ti-check" },
      failed: { path: documents_path(secondary_sale_id: params[:secondary_sale_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:offer_secondary_sale_id, :eq, params[:secondary_sale_id]],
          [:owner_type, :eq, "Offer"],
          [:esign_status, :eq, "failed"]
        ])), subtitle: "Failed", progress_bar_color: "danger", icon: "ti ti-x" },
      requested: { path: documents_path(secondary_sale_id: params[:secondary_sale_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:offer_secondary_sale_id, :eq, params[:secondary_sale_id]],
          [:owner_type, :eq, "Offer"],
          [:esign_status, :eq, "requested"]
        ])), subtitle: "Requested", progress_bar_color: "info", icon: "ti ti-mail" },
      all: { path: documents_path(secondary_sale_id: params[:secondary_sale_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:offer_secondary_sale_id, :eq, params[:secondary_sale_id]],
          [:owner_type, :eq, "Offer"]
        ])), subtitle: "Total", progress_bar_color: "primary", icon: "ti ti-list" }
    }

    documents = Document.sent_for_esign.where(owner_type: "Offer").joins(offer: :secondary_sale).where(offers: { secondary_sale_id: params[:secondary_sale_id] })

  elsif params[:entity_id].present?
    esig_types = {
      completed: { path: documents_path(entity_id: params[:entity_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:owner_type, :eq, "InvestorKyc"],
          [:esign_status, :eq, "completed"]
        ])), subtitle: "Completed", progress_bar_color: "success", icon: "ti ti-check" },
      failed: { path: documents_path(entity_id: params[:entity_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:owner_type, :eq, "InvestorKyc"],
          [:esign_status, :eq, "failed"]
        ])), subtitle: "Failed", progress_bar_color: "danger", icon: "ti ti-x" },
      requested: { path: documents_path(entity_id: params[:entity_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:owner_type, :eq, "InvestorKyc"],
          [:esign_status, :eq, "requested"]
        ])), subtitle: "Requested", progress_bar_color: "info", icon: "ti ti-mail" },
      all: { path: documents_path(entity_id: params[:entity_id], no_folders: true, template: ,q: ransack_query_params_multiple([
          [:owner_type, :eq, "InvestorKyc"]
        ])), subtitle: "Total", progress_bar_color: "primary", icon: "ti ti-list" }
    }

    documents = Document.sent_for_esign.where(owner_type: "InvestorKyc").joins(:investor_kyc).where(investor_kycs: { entity_id: params[:entity_id] })
  end
%>


<div class="row">
  <% esig_types.each do |type, data| %>
    <div class="col">
      <a href="<%= data[:path] %>" data-turbo-frame="e_signatures_list">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div>
                <h3 class="fs-8"><%= policy_scope(documents.send("esign_status_#{type}")).count %></h3>
                <h6 class="card-subtitle mb-1 text-muted"><%= data[:subtitle] %></h6>
              </div>
              <div class="ms-auto">
                <span class="text-<%= data[:progress_bar_color] %> display-6"><i class="<%= data[:icon] %>"></i></span>
              </div>
            </div>
            <div class="progress-bar text-bg-<%= data[:progress_bar_color] %>" role="progressbar" style="width: 100%; height: 6px;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
      </a>
    </div>
  <% end %>
</div>