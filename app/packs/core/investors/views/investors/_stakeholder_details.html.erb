<%
  label = t('investor_details_nav.users')
%>

<div class="associated_entity" data-controller="tabs tabdetails">
  <nav id="investor_tabs" class="nav nav-pills nav-justified p-3 mb-3 rounded align-items-center card flex-row"  role="tablist">

      <a id="stakeholder_users_tab" class="nav-link active" data-bs-toggle="pill" data-bs-toggle="tab" href="#investors-tab">
        <%= label %>
      </a>

      <% if investor.entity.permissions.enable_kycs? %>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#kycs-tab">
            <%= t('investor_details_nav.kyc') %>
        </a>
      <% end %>

      <% if current_user.entity.is_fund? %>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#commitments-tab"><%= t('investor_details_nav.commitments') %></a>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#fund-units-tab"><%= t('investor_details_nav.units') %></a>
      <% else %>
        <% if investor.entity.permissions.enable_investments? %>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#investments-tab">
            <%= t('investor_details_nav.investments') %>
        </a>
        <% end %>
      <% end %>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#tasks-tab">
          <%= t('investor_details_nav.tasks') %>
      </a>

    <% if policy(investor).update? %>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#access-rights-tab">
          <%= t('investor_details_nav.access_rights') %>
        </a>
    <% end %>

    <% if current_user.has_cached_role?(:company_admin) %>
      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#emails-tab">
          <%= t('investor_details_nav.emails') %>
      </a>
    <% end %>

  </nav>

  <div class="tab-content" data-controller="datatable">

        <div id="investors-tab" class="tab-pane fade show active">
          <div id="investor_accesses" class="associated_entity">
            <% params[:investor_id] = investor.id %>
            <%= render "/investor_accesses/index", investor_accesses: investor.investor_accesses.includes(:user, :granter),
                investor: investor, label: label %>
          </div>
        </div>

        <div id="investments-tab" class="tab-pane fade">
          <div id="investments" class="associated_entity">
            <%= turbo_frame_tag "investments_frame", target: "_top", src: investments_path(investor_id: investor.id), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <div id="notes-tab" class="tab-pane fade">
          <div id="notes" class="associated_entity">
            <%= turbo_frame_tag "notes_frame", target: "_top", src: notes_path(investor_id: investor.id), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <div id="tasks-tab" class="tab-pane fade">
          <div id="tasks" class="associated_entity">
            <%= turbo_frame_tag "task_list", target: "_top", src: tasks_path(for_entity_id: investor.investor_entity_id, entity_id: investor.entity_id), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <div id="reminders-tab" class="tab-pane fade">
          <div id="reminders" class="associated_entity">
            <%= turbo_frame_tag "reminders_list", target: "_top", src: reminders_path( owner_id: investor.id, owner_type: "Investor", sent: false), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <% if investor.entity.permissions.enable_kycs? %>
          <div id="kycs-tab" class="tab-pane fade">
            <div id="kycs" class="associated_entity">
              <%= turbo_frame_tag "investor_kycs_frame", loading: :lazy, src: investor_kycs_path(investor_id: investor.id), target: "_top" do %>
                <%= render "/layouts/loading" %>
              <% end %>
            </div>
          </div>
        <% end %>

        <div id="commitments-tab" class="tab-pane fade in">
          <div id="commitments" class="associated_entity">
            <%= turbo_frame_tag "capital_commitments_frame", target: "_top", loading: :lazy, src: capital_commitments_path(investor_id: investor.id) do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <div id="fund-units-tab" class="tab-pane fade">
          <div id="fund_units" class="associated_entity">
            <%= turbo_frame_tag "fund_units_list", target: "_top", src: fund_units_path(investor_id: investor.id, cols: "all"), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>


      <div id="access-rights-tab" class="tab-pane fade in">
          <div id="access_rights" class="associated_entity">

            <nav class="nav nav-pills nav-justified p-3 mb-3 rounded align-items-center card flex-row"  role="tablist">

              <a class="nav-link active" data-bs-toggle="pill" data-bs-toggle="tab" href="#access_rights_to_investors_tab">
                <%= t('investor_details_nav.employee_access') %>
              </a>

              <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#access_rights_for_investors_tab">
                <%= t('investor_details_nav.investor_access') %>
              </a>

            </nav>
            <div class="tab-content">

              <div id="access_rights_to_investors_tab" class="tab-pane show active">
                <%= turbo_frame_tag "investor_access_rights_frame", target: "_top", loading: :lazy,  src: access_rights_path(owner_id: investor.id, owner_type: "Investor", entity_id: investor.entity_id, form_type: "investor_form", frame: "investor_access_rights_frame") do %>

                <% end %>
              </div>

              <div id="access_rights_for_investors_tab" class="tab-pane fade">
                <%= turbo_frame_tag "access_rights_frame", target: "_top", loading: :lazy,  src: access_rights_path(investor_id: investor.id , entity_id: current_user.entity_id, form_type: "none", owner_id: investor.id, owner_type: "Investor", with_deleted: true)  do %>

                <% end %>
              </div>

            </div>

          </div>
      </div>

      <% if current_user.has_cached_role?(:company_admin) %>
        <div id="emails-tab" class="tab-pane fade">
          <div id="emails" class="associated_entity">
            <%= turbo_frame_tag "incoming_emails_list", target: "_top", src: incoming_emails_path(owner_id: investor.id, owner_type: "Investor"), loading: :lazy do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>
      <% end %>

  </div>
</div>