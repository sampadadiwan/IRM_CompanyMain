
<%= render "/capital_commitments/capital_commitment_stats", capital_commitment: @capital_commitment %>

<% if current_user.entity_id == @capital_commitment.entity_id %>
  <%= render "capital_commitments/show", capital_commitment: @capital_commitment %>
<% end %>

<div>

  <% if policy(@capital_commitment).update? %>
    <%= link_to "Edit" , edit_capital_commitment_path(@capital_commitment), {class: "btn btn-outline-primary" } %>
    <%= button_to "Delete" , @capital_commitment, method: :delete, class: "btn btn-outline-danger" ,
            form_class: "deleteButton" , data: {action: "click->confirm#popup" , turbo:false} %>

                
  <% end %>

  <% if policy(@capital_commitment).update? %>
    <div class="btn-group">
      <div class="dropdown">
        <button class="btn btn-outline-success dropdown-toggle" type="button" id="commitment_actions"
                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Actions
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

          <%= link_to "LP Account Statement" , report_capital_commitment_path(@capital_commitment, report: "lp_statement"), {class: "dropdown-item" } %>

          <% report = Report.where(entity_id: current_user.entity_id, name: "Folio Account Entries").first %>
          <%= link_to "Folio Account Entries" , dynamic_report_path(report, fund_id: @capital_commitment.fund_id, folio_id: @capital_commitment.folio_id, reporting_date: Date.today - 12.months), {class: "dropdown-item" }  if report %>

          <div class="dropdown-divider"></div>
      
          <% if policy(@capital_commitment).generate_documentation? %>

            <%= button_to "Generate All Documents", 
            generate_documentation_capital_commitment_path(@capital_commitment), 
            method: :patch, class: "dropdown-item" , 
            form_class: "deleteButton",data: {action: "click->confirm#popup", method: :patch,
            msg: "Generate Documents for this capital commitment from kyc and fund info. This will delete any previously generated documentation for this capital commitment. Proceed?"}  %>

            <div class="dropdown-divider"></div>

            <% @capital_commitment.templates("Commitment Template").each do |template| %>
              <%= button_to "Generate #{template.name}", 
              generate_documentation_capital_commitment_path(@capital_commitment, template_id: template.id), 
              method: :patch, class: "dropdown-item" , 
              form_class: "deleteButton",data: {action: "click->confirm#popup", method: :patch,
              msg: "Generate #{template.name} for this capital commitment from kyc and fund info. This will delete any previously generated documentation for this capital commitment. Proceed?"}  %>

            <% end %>

          <% end %>


          <%= link_to "Generate SOA", 
          generate_soa_form_capital_commitment_path(@capital_commitment), 
          class: "dropdown-item" if policy(@capital_commitment).generate_soa? %>
          
        </div>
      </div>
    </div>
  <% end %>
  
  
</div>
<%= render "capital_commitments/details", capital_commitment: @capital_commitment %>
