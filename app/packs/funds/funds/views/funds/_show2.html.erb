<%= render ToggleCard.new(title: "Fund: #{fund.name}", css_class: "show_funds", state: "closed") do %>

    <div class="row">
      <!-- Left Column: Main Info -->
      <div class="col-lg-8">
        <div class="card shadow-sm border-0">
          <div class="card-header  border-bottom py-3">
            <h5 class="mb-0 fw-bold"><i class="ti ti-info-circle me-2 text-primary"></i>General Information</h5>
          </div>
          <div class="card-body">
            <div class="row g-4">
              <div class="col-md-6">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Name</label>
                <div class="fs-4 fw-medium"><%= fund.name %></div>
              </div>

              <div class="col-md-6">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Entity</label>
                <div class="fs-4 fw-medium"><%= fund.entity.name %></div>
              </div>

              <% if fund.master_fund_id.present? %>
                <div class="col-md-6">
                  <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Master Fund</label>
                  <div class="fs-4"><%= link_to fund.master_fund, class: "text-decoration-none fw-bold text-primary" %></div>
                </div>
              <% end %>


              <div class="col-md-6">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Currency</label>
                <div class="fs-4 fw-medium"><%= fund.currency %></div>
              </div>

              <% if fund.unit_types.present? %>
                <div class="col-md-12">
                  <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Unit Types</label>
                  <div class="fs-4 fw-medium">
                    <% fund.unit_types.split(',').each do |unit_type| %>
                      <span class="badge bg-secondary rounded-pill px-3 py-2"><%= unit_type.strip %></span>
                    <% end %>
                  </div>
                </div>
              <% end %>

              <div class="col-12">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Tags</label>
                <div>
                  <% if fund.tag_list.present? %>
                    <%= fund.tag_list %>
                  <% else %>
                     <span class="text-muted fst-italic">No tags</span>
                  <% end %>
                </div>
              </div>

              <div class="col-12">
                <label class="text-muted text-uppercase fw-bold fs-1 mb-1">Details</label>
                <div class="p-3 bg-light rounded border-start border-4 border-primary">
                  <%= fund.details&.html_safe.presence || '<span class="text-muted fst-italic">No details provided</span>'.html_safe %>
                </div>
              </div>
            </div>
          </div>
        </div>


        <% if current_user %>
           <div class="card shadow-sm border-0 mt-4">
            <div class="card-header  border-bottom py-3">
              <h5 class="mb-0 fw-bold"><i class="ti ti-settings me-2 text-info"></i>Other Details </h5>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-6 col-md-3">

                  <table class="table table-borderless mb-0">
                    <%= display_custom_fields(fund, collapsed: false) %>
                  </table>
                </div>
              </div>
            </div>
           </div>
        <% end %>
      </div>

      <!-- Right Column: Settings & Meta -->
      <div class="col-lg-4">
        <% if fund.has_tracking_currency? && policy(fund).update? %>
          <div class="card shadow-sm border-0 mb-4">
            <div class="card-header border-bottom py-3">
              <h6 class="mb-0 fw-bold d-flex align-items-center"><i class="ti ti-chart-line me-2 text-info"></i>Tracking Currency (<%= fund.tracking_currency %>)</h6>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-6">
                  <div class="p-3 rounded bg-light-info text-center h-100">
                    <small class="d-block text-muted text-uppercase fw-bold mb-1">Committed</small>
                    <div class="fw-bold"><%= money_to_currency fund.tracking_committed_amount, params %></div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="p-3 rounded bg-light-info text-center h-100">
                    <small class="d-block text-muted text-uppercase fw-bold mb-1">Call Amount</small>
                    <div class="fw-bold"><%= money_to_currency fund.tracking_call_amount, params %></div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="p-3 rounded bg-light-info text-center h-100">
                    <small class="d-block text-muted text-uppercase fw-bold mb-1">Collected</small>
                    <div class="fw-bold"><%= money_to_currency fund.tracking_collected_amount, params %></div>
                  </div>
                </div>
                <div class="col-6">
                  <div class="p-3 rounded bg-light-info text-center h-100">
                    <small class="d-block text-muted text-uppercase fw-bold mb-1">Distributed</small>
                    <div class="fw-bold"><%= money_to_currency fund.tracking_distribution_amount, params %></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Key Dates -->
        <div class="card shadow-sm border-0 mb-4">
          <div class="card-header  border-bottom py-3">
            <h6 class="mb-0 fw-bold d-flex align-items-center"><i class="ti ti-calendar me-2 text-warning"></i>Key Dates</h6>
          </div>
          <ul class="list-group list-group-flush">
            <% if fund.first_close_date.present? %>
              <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                <span class="text-muted">First Close</span>
                <span class="fw-bold"><%= l fund.first_close_date %></span>
              </li>
            <% end %>
            <% if fund.last_close_date.present? %>
              <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                <span class="text-muted">Last Close</span>
                <span class="fw-bold"><%= l fund.last_close_date %></span>
              </li>
            <% end %>
            <% unless fund.first_close_date.present? || fund.last_close_date.present? %>
              <li class="list-group-item py-3 text-center text-muted fst-italic">No dates set</li>
            <% end %>
          </ul>
        </div>

        <% if policy(fund).update? %>
          <!-- Configuration -->
          <div class="card shadow-sm border-0 mb-4">
             <div class="card-header  border-bottom py-3">
              <h6 class="mb-0 fw-bold d-flex align-items-center"><i class="ti ti-settings me-2 text-secondary"></i>Settings & Visibility</h6>
            </div>
            <ul class="list-group list-group-flush">
              <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                <span class="text-muted">Show Fund Ratios</span>
                <%= display_boolean fund.show_fund_ratios %>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                <span class="text-muted">Show Portfolios</span>
                <%= display_boolean fund.show_portfolios %>
              </li>
            </ul>
          </div>


          <!-- Docs & Emails -->
           <div class="card shadow-sm border-0 mb-4">
             <div class="card-body">


               <div>
                 <label class="text-muted text-uppercase fw-bold fs-1 mb-2">Signatory Emails</label>
                 <div class="text-break bg-light p-2 rounded"><%= fund.esign_emails.presence || '-' %></div>
               </div>
             </div>
           </div>
        <% end %>
      </div>
    </div>

<% end %>