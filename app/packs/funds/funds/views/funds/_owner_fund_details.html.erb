<div class="associated_entity" data-controller="tabs tabdetails">

    <nav class="nav nav-pills nav-justified p-3 mb-3 rounded align-items-center card flex-row" role="tablist">

      <a class="nav-link active" data-bs-toggle="pill" data-bs-toggle="tab" href="#commitments-tab">
        <%= t('funds.fund_details.commitments') %>
      </a>

      <% unless false && fund.cat3? %>
        <a id="capital_calls_tab" class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#capital-calls-tab">
          <%= t('funds.fund_details.calls') %>
        </a>
      <% end %>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#capital-distributions-tab">
        <%= t('funds.fund_details.distributions') %>
      </a>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#fund-ratios-tab">
        <%= t('funds.fund_details.ratios') %>
      </a>

      <% if fund.entity.permissions.enable_fund_portfolios? %>
        <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#portfolio-investments-tab">
          <%= t('funds.fund_details.portfolio') %>
        </a>
      <% end %>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" id="documents_tab" href="#docs-tab">
        <%= t('funds.fund_details.documents') %>
      </a>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#tasks-tab">
        <%= t('funds.fund_details.tasks') %>
      </a>

      <a class="nav-link" data-bs-toggle="pill" data-bs-toggle="tab" href="#access-rights-tab">
        <%= t('funds.fund_details.access') %>
      </a>

    </nav>


    <div class="tab-content">

        <div id="docs-tab" class="tab-pane fade in">
          <div id="docs" class="associated_entity">

              <% src = folder_documents_path(entity_id: fund.entity_id, folder_id: fund.document_folder.id, show_root_docs: true) %>

              <%= turbo_frame_tag "documents_tree_frame", target: "_top", loading: :lazy, src: src do %>
                <%= render "/layouts/loading" %>
              <% end %>

          </div>
        </div>

        <div id="commitments-tab" class="tab-pane fade in show active">
          <div id="commitments" class="associated_entity">
              <%= turbo_frame_tag "capital_commitments_frame", target: "_top", loading: :lazy, src: capital_commitments_path(fund_id: fund.id) do %>
                <%= render "/layouts/loading" %>
              <% end %>
          </div>
        </div>


        <% unless false && fund.cat3? %>
        <div id="capital-calls-tab" class="tab-pane fade in">
          <div id="capital-calls" class="associated_entity">
             <%= turbo_frame_tag "capital_calls_frame", target: "_top", loading: :lazy, src: capital_calls_path(fund_id: fund.id) do %>
                <%= render "/layouts/loading" %>
              <% end %>
          </div>
        </div>
        <% end %>

        <div id="capital-distributions-tab" class="tab-pane fade in">
          <div id="capital-distributions" class="associated_entity">
            <% src = capital_distributions_path(fund_id: fund.id) %>
            <%= turbo_frame_tag "capital_distributions_frame", target: "_top", loading: :lazy, src: src do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>

        <div id="tasks-tab" class="tab-pane fade">
          <div id="tasks" class="associated_entity">
            <% investor = Investor.for(current_user, fund.entity).first %>
            <% src = tasks_path( for_entity_id: nil,
                                    entity_id: fund.entity_id,
                                    owner_id: fund.id, owner_type: "Fund") %>
            <%= turbo_frame_tag "task_list", target: "_top", loading: :lazy, src: src do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>


        <!-- For the portfolio and fund ratios, use the master_fund if its present as in the feeder fund we want to see the master_fund portfolio and ratios p-->
        <%
          fund_id = fund.master_fund.present? ?  fund.master_fund_id : fund.id
        %>

        <% if fund.entity.permissions.enable_fund_portfolios? %>
          <div id="portfolio-investments-tab" class="tab-pane fade">
            <div id="portfolio_investments" class="associated_entity">
              <%= turbo_frame_tag "default_portfolio dashboard_frame", target: "_top", loading: :lazy, src: dashboard_fund_path(fund, dashboard_name: "Portfolio Dashboard") do %>

                <%= render "/layouts/loading" %>

              <% end %>
            </div>
          </div>
        <% end %>


        <div id="fund-ratios-tab" class="tab-pane fade in">
          <div id="fund-ratios" class="associated_entity">
            <% src = fund_ratios_path(fund_id: fund.id, fund_ratios_only: true, owner_type: "Fund", scenario: "Default") %>
            <%= turbo_frame_tag "fund_ratios_frame", target: "_top", loading: :lazy, src: src do %>
                <%= render "/layouts/loading" %>
              <% end %>
          </div>
        </div>

        <% if fund.entity.permissions.enable_units? %>
        <div id="fund-units-tab" class="tab-pane fade">
          <div id="fund_units" class="associated_entity">
            <% src = fund_units_path(fund_id: fund.id) %>
            <%= turbo_frame_tag "fund_units_list", target: "_top", loading: :lazy, src: src do %>
              <%= render "/layouts/loading" %>
            <% end %>
          </div>
        </div>
        <% end %>

        <div id="access-rights-tab" class="tab-pane fade in">

            <div id="access_rights" class="associated_entity" data-controller="datatable">
              <% form_type = !belongs_to_entity_id?(current_user, fund.entity_id) ? "investor_form" : nil %>
              <% src = access_rights_path(owner_id: fund.id, owner_type: "Fund",
                                             entity_id: current_user.entity_id, form_type: form_type) %>
              <%= turbo_frame_tag "access_rights_frame", target: "_top", loading: :lazy, src: src do %>
                <%= render "/layouts/loading" %>
              <% end %>

            </div>

        </div>

    </div>

</div>