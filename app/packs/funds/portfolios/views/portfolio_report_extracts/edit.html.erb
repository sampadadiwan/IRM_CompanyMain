<!-- app/views/portfolio_report_extracts/edit.html.erb -->
<div data-controller="wizard portfolio-report-extract-editor">
  <div class="card">
    <div class="card-body">
      <h1>Edit Portfolio Report Extract <%= link_to @portfolio_report_extract.portfolio_company %>
        <button type="button" class="btn btn-success float-right" data-action="click->portfolio-report-extract-editor#addSection">Add Section</button>
      </h1>
    </div>
  </div>


  <div class="wizard_container">
  <div class="row justify-content-md-center">
    <div class="stepwizard col-md-10">
      <div class="stepwizard-row setup-panel" data-portfolio-report-extract-editor-target="stepWizardRow">
        <% @sections.each_with_index do |(key, _), index| %>
          <div class="stepwizard-step">
            <a href="#step-<%= index + 1 %>" type="button" class="btn <%= index.zero? ? 'btn-outline-primary' : 'disabled btn-outline-primary' %> btn-outline-circle"><%= index + 1 %></a>
            <p><%= key %></p>
          </div>
        <% end %>
      </div>
    </div>
  </div>


  <%= form_with model: @portfolio_report_extract,
                url: portfolio_report_extract_path(@portfolio_report_extract),
                method: :put,
                local: true,
                class: "wizard_form row justify-content-md-center" do |f| %>

    <div id="sections-container" data-portfolio-report-extract-editor-target="sectionsContainer">
      <% @sections.each_with_index do |(key, lines), index| %>
        <div class="col-md-10 setup-content section-fields" id="step-<%= index + 1 %>">
          <div class="card">
            <div class="card-header">
              <%= text_field_tag "sections[#{index}][name]", key, class: "form-control" %>
            </div>
            <div class="card-body">
              <%= text_area_tag(
                    "sections[#{index}][body]",
                    lines.join("\n"),
                    id: "sections_#{key.parameterize}",
                    rows: [lines.size + 1, 8].max,
                    class: "form-control",
                    style: "width: 100%;"
                  ) %>

              <div class="form-group" style="margin-top: 1rem;">
                <% if @sections.keys.last == key %>
                  <%= f.submit "Save", class: "btn btn-outline-primary btn-lg" %>
                <% else %>
                  <button class="btn btn-outline-primary nextBtn btn-lg pull-right" type="button">Next</button>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
    </div>


  <% end %>

  <template id="section-template" data-portfolio-report-extract-editor-target="template">
    <div class="col-md-10 setup-content section-fields" style="display: none;">
      <div class="card">
        <div class="card-header">
          <input type="text" name="sections[INDEX][name]" class="form-control" placeholder="Section Name">
        </div>
        <div class="card-body">
          <textarea name="sections[INDEX][body]" class="form-control" rows="8" style="width: 100%;"></textarea>
          <div class="form-group" style="margin-top: 1rem;">
            <input type="submit" value="Save" class="btn btn-outline-primary btn-lg">
          </div>
        </div>
      </div>
    </div>
  </template>
</div>
