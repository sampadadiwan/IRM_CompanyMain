<% col_size ||= 6 %>
<%
    hide_show_btn ||= false
    params[:force_units] = investment_opportunity.default_currency_units
%>

<div class="col-md-<%= col_size %> mb-4">
    <div class="investment-opportunity-card h-100 d-flex flex-row overflow-hidden">

        <!-- Left Section: Identity (Logo + Name) -->
        <div class="d-flex flex-column align-items-center justify-content-center p-3 identity-section" style="width: 35%; min-width: 140px;">
            <div class="mb-3 text-center w-100 d-flex align-items-center justify-content-center" style="height: 80px;">
                <% if investment_opportunity.logo.present? %>
                    <%= image_tag investment_opportunity.logo.url(expires_in: 60*60*24*7), class: "img-fluid", style: "max-height: 80px; object-fit: contain;" %>
                <% else %>
                     <div class="d-flex align-items-center justify-content-center rounded-circle logo-fallback shadow-sm" style="width: 60px; height: 60px;">
                        <h4 class="mb-0 text-primary"><%= investment_opportunity.company_name.first(2).upcase %></h4>
                    </div>
                <% end %>
            </div>

            <h5 class="text-center mb-1 company-name-text px-2" style="font-size: 1rem; line-height: 1.3;">
                <%= link_to investment_opportunity.company_name, investment_opportunity, class: "text-decoration-none" %>
            </h5>

            <% if show_tags && investment_opportunity.tag_list.present? %>
                <div class="mt-2 text-center px-2">
                    <% tag = investment_opportunity.tag_list.split(",").first %>
                    <span class="badge badge-white border text-muted fw-normal small"><%= tag %></span>
                </div>
            <% end %>
        </div>

        <!-- Right Section: Metrics & Action -->
        <div class="d-flex flex-column flex-grow-1" style="width: 65%;">
            <div class="card-body-custom p-3 flex-grow-1 d-flex flex-column justify-content-center">

                <!-- Hero Metric: Fund Raise -->
                <div class="hero-metric mb-3 p-0 border-0 bg-transparent shadow-none">
                     <div class="icon-box" style="width: 40px; height: 40px;">
                        <i class="ti ti-currency-dollar" style="font-size: 1.1rem;"></i>
                    </div>
                    <div class="content pl-0">
                        <span class="label">Fund Raise</span>
                        <span class="value" style="font-size: 1.3rem;"><%= money_to_currency investment_opportunity.fund_raise_amount, params %></span>
                    </div>
                </div>

                 <%
                    if params[:force_units] == "Crores" && investment_opportunity.min_ticket_size.to_d < 100_00000
                        params[:force_units] = "Lakhs"
                    end
                %>

                <!-- Secondary Metrics Row -->
                <div class="row m-0">
                    <div class="col-6 pl-0 pr-2">
                         <div class="metric-item mb-0 p-0 border-0 bg-transparent">
                            <div class="icon-label mb-1">
                                <i class="ti ti-ticket ticket-icon mr-1"></i>
                                <span>Min Ticket</span>
                            </div>
                            <span class="value" style="font-size: 1rem;"><%= money_to_currency investment_opportunity.min_ticket_size, params %></span>
                        </div>
                    </div>
                    <div class="col-6 px-0 metric-separator pl-2">
                        <div class="metric-item mb-0 p-0 border-0 bg-transparent">
                            <div class="icon-label mb-1">
                                <i class="ti ti-calendar date-icon mr-1"></i>
                                <span>Closes On</span>
                            </div>
                            <span class="value" style="font-size: 1rem;"><%= l investment_opportunity.last_date %></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Footer (Cool Button) -->
            <% unless hide_show_btn %>
                <div class="action-footer px-3 pb-3 pt-0 border-top-0 bg-transparent">
                    <% link = policy(investment_opportunity).update? ? investment_opportunity_path(investment_opportunity) : investment_opportunity_path(investment_opportunity, preview: true) %>
                    <%= link_to link, class: "btn btn-view-opportunity w-100 justify-content-center" do %>
                        <span><%= t_common(:show) %></span>
                        <i class="ti ti-arrow-right ml-2"></i>
                    <% end %>
                </div>
            <% end %>
        </div>
    </div>
</div>

<% params[:force_units] = nil %>